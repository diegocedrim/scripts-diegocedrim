[
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335644", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/s1monw/following{/other_user}", 
            "events_url": "https://api.github.com/users/s1monw/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/s1monw/orgs", 
            "url": "https://api.github.com/users/s1monw", 
            "gists_url": "https://api.github.com/users/s1monw/gists{/gist_id}", 
            "html_url": "https://github.com/s1monw", 
            "subscriptions_url": "https://api.github.com/users/s1monw/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/973334?v=3", 
            "repos_url": "https://api.github.com/users/s1monw/repos", 
            "received_events_url": "https://api.github.com/users/s1monw/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/s1monw/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "s1monw", 
            "type": "User", 
            "id": 973334, 
            "followers_url": "https://api.github.com/users/s1monw/followers"
        }, 
        "event": "mentioned", 
        "id": 542335644
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335645", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/s1monw/following{/other_user}", 
            "events_url": "https://api.github.com/users/s1monw/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/s1monw/orgs", 
            "url": "https://api.github.com/users/s1monw", 
            "gists_url": "https://api.github.com/users/s1monw/gists{/gist_id}", 
            "html_url": "https://github.com/s1monw", 
            "subscriptions_url": "https://api.github.com/users/s1monw/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/973334?v=3", 
            "repos_url": "https://api.github.com/users/s1monw/repos", 
            "received_events_url": "https://api.github.com/users/s1monw/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/s1monw/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "s1monw", 
            "type": "User", 
            "id": 973334, 
            "followers_url": "https://api.github.com/users/s1monw/followers"
        }, 
        "event": "subscribed", 
        "id": 542335645
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335646", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/jasontedor/following{/other_user}", 
            "events_url": "https://api.github.com/users/jasontedor/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/jasontedor/orgs", 
            "url": "https://api.github.com/users/jasontedor", 
            "gists_url": "https://api.github.com/users/jasontedor/gists{/gist_id}", 
            "html_url": "https://github.com/jasontedor", 
            "subscriptions_url": "https://api.github.com/users/jasontedor/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/4744941?v=3", 
            "repos_url": "https://api.github.com/users/jasontedor/repos", 
            "received_events_url": "https://api.github.com/users/jasontedor/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/jasontedor/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "jasontedor", 
            "type": "User", 
            "id": 4744941, 
            "followers_url": "https://api.github.com/users/jasontedor/followers"
        }, 
        "event": "mentioned", 
        "id": 542335646
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335647", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/jasontedor/following{/other_user}", 
            "events_url": "https://api.github.com/users/jasontedor/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/jasontedor/orgs", 
            "url": "https://api.github.com/users/jasontedor", 
            "gists_url": "https://api.github.com/users/jasontedor/gists{/gist_id}", 
            "html_url": "https://github.com/jasontedor", 
            "subscriptions_url": "https://api.github.com/users/jasontedor/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/4744941?v=3", 
            "repos_url": "https://api.github.com/users/jasontedor/repos", 
            "received_events_url": "https://api.github.com/users/jasontedor/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/jasontedor/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "jasontedor", 
            "type": "User", 
            "id": 4744941, 
            "followers_url": "https://api.github.com/users/jasontedor/followers"
        }, 
        "event": "subscribed", 
        "id": 542335647
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335648", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "event": "mentioned", 
        "id": 542335648
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335649", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "event": "subscribed", 
        "id": 542335649
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335650", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/areek/following{/other_user}", 
            "events_url": "https://api.github.com/users/areek/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/areek/orgs", 
            "url": "https://api.github.com/users/areek", 
            "gists_url": "https://api.github.com/users/areek/gists{/gist_id}", 
            "html_url": "https://github.com/areek", 
            "subscriptions_url": "https://api.github.com/users/areek/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/753679?v=3", 
            "repos_url": "https://api.github.com/users/areek/repos", 
            "received_events_url": "https://api.github.com/users/areek/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/areek/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "areek", 
            "type": "User", 
            "id": 753679, 
            "followers_url": "https://api.github.com/users/areek/followers"
        }, 
        "event": "mentioned", 
        "id": 542335650
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335651", 
        "created_at": "2016-02-07T21:53:21Z", 
        "actor": {
            "following_url": "https://api.github.com/users/areek/following{/other_user}", 
            "events_url": "https://api.github.com/users/areek/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/areek/orgs", 
            "url": "https://api.github.com/users/areek", 
            "gists_url": "https://api.github.com/users/areek/gists{/gist_id}", 
            "html_url": "https://github.com/areek", 
            "subscriptions_url": "https://api.github.com/users/areek/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/753679?v=3", 
            "repos_url": "https://api.github.com/users/areek/repos", 
            "received_events_url": "https://api.github.com/users/areek/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/areek/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "areek", 
            "type": "User", 
            "id": 753679, 
            "followers_url": "https://api.github.com/users/areek/followers"
        }, 
        "event": "subscribed", 
        "id": 542335651
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/542335708", 
        "created_at": "2016-02-07T21:53:28Z", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "event": "labeled", 
        "label": {
            "color": "cfcfcf", 
            "name": "non-issue"
        }, 
        "id": 542335708
    }, 
    {
        "body": "Pushed some more commits ..", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/181259896", 
        "event": "commented", 
        "created_at": "2016-02-08T08:57:24Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-181259896", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "updated_at": "2016-02-08T08:57:24Z", 
        "user": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "id": 181259896, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "body": "I like the idea of decoupling transport from the actual action logic. By not having everything in a single file anymore, we need to be extra careful however to document what each class does, especially w.r.t. failure modes.\r\n\r\nLooking at the code, I would like to suggest more changes to make the classes even more testable / self-contained. The idea is to get rid of abstract classes and use listeners and functional interfaces where possible:\r\n\r\n- `ReplicaOperation`: I would just add an `ActionListener<Void>` parameter to the class. We can then remove `finishedAsSuccess` and `finishedAsFailed` and make it a concrete class (no need for tests to do some subclassing).\r\n- `PrimaryReroute`: Add an `ActionListener<Response>` parameter, replacing `finishedAsSuccess` and `finishedAsFailed`. This leaves us with two abstract methods `performPrimaryOperation` and `finishedAsReroute` in `PrimaryReroute`. We could replace them by adding two parameters to the class, a performPrimaryAction and a rerouteAction, both implementing the same functional interface:\r\n```\r\ninterface NodeAction<Request, Response> {\r\n  void execute(DiscoveryNode, Request, ActionListener<Response>)\r\n}\r\n```\r\n- `PrimaryOperation`: This class has an inner class `ReplicationPhase`. I would split them into two top-level classes.\r\n- For `PrimaryOperation`, add again ActionListener<Response> parameter. Also add parameter `NodeAction<Request, Response> routeToRelocatedPrimaryAction` and finally a parameter `Consumer<Tuple<Response, ReplicaRequest>> replicationAction` that executes the replication action.\r\n- For `ReplicationPhase`, the following two parameters need to be added:\r\n`ActionListener<Response> listener` (called after replication phase is finished) and\r\n`NodeAction<ReplicaRequest, Void> performOnReplicaAction` (the transport action to actually execute the request on replica)\r\n\r\n\r\nHow does this look like?\r\n\r\nhttps://github.com/ywelsch/elasticsearch/commit/6c4a101d0ddf81a597cbcc0c93b104303312152d", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/181310327", 
        "event": "commented", 
        "created_at": "2016-02-08T11:08:59Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-181310327", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "updated_at": "2016-02-08T11:08:59Z", 
        "user": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "id": 181310327, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "body": "> we need to be extra careful however to document what each class does\r\n\r\nAgreed. Didn't do that yet.\r\n\r\n> The idea is to get rid of abstract classes and use listeners and functional interfaces where possible.\r\n\r\nI thought about that too (and tried it some as well). My biggest reason not go down that route is that I find the code easier to read when you implement methods with name, compared to a long list of callables as parameters to the constructors. \r\n\r\n> PrimaryOperation: This class has an inner class ReplicationPhase. I would split them into two top-level classes.\r\n\r\nI debated this one for a long time as well. I ended falling on the side of the fence where having a replication phase on it's own is a step too far. My idea was that this way we have a clear separation of \"things that happen on route to the primary\"(i.e., `PrimaryReroute`) , \"things that happen on/done by the primary\" (i.e., PrimaryOpereation) and \"things that happen on the replica\" (i.e., ReplicaOperation)\r\n\r\nAll of which is a matter of taste. Let's see what others think.\r\n\r\n\r\n", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/181341760", 
        "event": "commented", 
        "created_at": "2016-02-08T12:18:25Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-181341760", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "updated_at": "2016-02-08T12:18:25Z", 
        "user": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "id": 181341760, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "body": "I pushed another iteration, this time only dealing with things that are done in the current PrimaryPhase & Replication. This is to reduce the scope of the change. We can then decide whether to do something similar for reroute phase or not.\r\n\r\nThe new itration is under the [poc2](https://github.com/bleskes/elasticsearch/tree/replication_the_great_recouple/core/src/main/java/org/elasticsearch/action/support/replication/poc2) package. I chose not to do it inline as I think the diff will only be confusing and it's easier to use the old implementaion as refrece. Concreting we have:\r\n1) [ReplicatedOperation](https://github.com/bleskes/elasticsearch/blob/replication_the_great_recouple/core/src/main/java/org/elasticsearch/action/support/replication/poc2/ReplicatedOperation.java) - this is the replacement of the PrimaryPhase and ReplicationPhase. I chose to merge the two because I think it makes the code simpler. \r\n2) [TransportReplicationAction3](https://github.com/bleskes/elasticsearch/blob/replication_the_great_recouple/core/src/main/java/org/elasticsearch/action/support/replication/poc2/TransportReplicationAction3.java) - This class takes care of all the glue of hooking up ReplicatedOperation with the rest of the infrastructure. \r\n3) [TransportIndexAction3](https://github.com/bleskes/elasticsearch/blob/replication_the_great_recouple/core/src/main/java/org/elasticsearch/action/support/replication/poc2/TransportIndexAction3.java) - a port of TransportIndexAction to the new base class. The change is minimal (minor method change) , which is great.\r\n\r\nOn the testing side everyting is in the [poc2](https://github.com/bleskes/elasticsearch/tree/replication_the_great_recouple/core/src/test/java/org/elasticsearch/action/support/replication/poc2) package as well. There are two classes - one to test the replication logic in ReplicatedOperation (the complicated part) and one simple class to test all the bridges (TransportReplicationAction3Tests).  For bravity I didn't copy the tests for the reroute phase.\r\n\r\n@s1monw @ywelsch @jasontedor - I would appreciate your feedback. If we like this, I would rewrite the PR to actually change the code (and address some nocommits). I would also like to only do this once #17038 is in, so I can take care of the conflicts (and not vice versa).", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/197832614", 
        "event": "commented", 
        "created_at": "2016-03-17T11:26:54Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-197832614", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "updated_at": "2016-03-17T11:26:54Z", 
        "user": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "id": 197832614, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593265491", 
        "created_at": "2016-03-17T11:26:54Z", 
        "actor": {
            "following_url": "https://api.github.com/users/s1monw/following{/other_user}", 
            "events_url": "https://api.github.com/users/s1monw/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/s1monw/orgs", 
            "url": "https://api.github.com/users/s1monw", 
            "gists_url": "https://api.github.com/users/s1monw/gists{/gist_id}", 
            "html_url": "https://github.com/s1monw", 
            "subscriptions_url": "https://api.github.com/users/s1monw/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/973334?v=3", 
            "repos_url": "https://api.github.com/users/s1monw/repos", 
            "received_events_url": "https://api.github.com/users/s1monw/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/s1monw/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "s1monw", 
            "type": "User", 
            "id": 973334, 
            "followers_url": "https://api.github.com/users/s1monw/followers"
        }, 
        "event": "mentioned", 
        "id": 593265491
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593265492", 
        "created_at": "2016-03-17T11:26:54Z", 
        "actor": {
            "following_url": "https://api.github.com/users/s1monw/following{/other_user}", 
            "events_url": "https://api.github.com/users/s1monw/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/s1monw/orgs", 
            "url": "https://api.github.com/users/s1monw", 
            "gists_url": "https://api.github.com/users/s1monw/gists{/gist_id}", 
            "html_url": "https://github.com/s1monw", 
            "subscriptions_url": "https://api.github.com/users/s1monw/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/973334?v=3", 
            "repos_url": "https://api.github.com/users/s1monw/repos", 
            "received_events_url": "https://api.github.com/users/s1monw/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/s1monw/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "s1monw", 
            "type": "User", 
            "id": 973334, 
            "followers_url": "https://api.github.com/users/s1monw/followers"
        }, 
        "event": "subscribed", 
        "id": 593265492
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593265493", 
        "created_at": "2016-03-17T11:26:54Z", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "event": "mentioned", 
        "id": 593265493
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593265494", 
        "created_at": "2016-03-17T11:26:54Z", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "event": "subscribed", 
        "id": 593265494
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593265495", 
        "created_at": "2016-03-17T11:26:54Z", 
        "actor": {
            "following_url": "https://api.github.com/users/jasontedor/following{/other_user}", 
            "events_url": "https://api.github.com/users/jasontedor/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/jasontedor/orgs", 
            "url": "https://api.github.com/users/jasontedor", 
            "gists_url": "https://api.github.com/users/jasontedor/gists{/gist_id}", 
            "html_url": "https://github.com/jasontedor", 
            "subscriptions_url": "https://api.github.com/users/jasontedor/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/4744941?v=3", 
            "repos_url": "https://api.github.com/users/jasontedor/repos", 
            "received_events_url": "https://api.github.com/users/jasontedor/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/jasontedor/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "jasontedor", 
            "type": "User", 
            "id": 4744941, 
            "followers_url": "https://api.github.com/users/jasontedor/followers"
        }, 
        "event": "mentioned", 
        "id": 593265495
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593265496", 
        "created_at": "2016-03-17T11:26:54Z", 
        "actor": {
            "following_url": "https://api.github.com/users/jasontedor/following{/other_user}", 
            "events_url": "https://api.github.com/users/jasontedor/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/jasontedor/orgs", 
            "url": "https://api.github.com/users/jasontedor", 
            "gists_url": "https://api.github.com/users/jasontedor/gists{/gist_id}", 
            "html_url": "https://github.com/jasontedor", 
            "subscriptions_url": "https://api.github.com/users/jasontedor/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/4744941?v=3", 
            "repos_url": "https://api.github.com/users/jasontedor/repos", 
            "received_events_url": "https://api.github.com/users/jasontedor/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/jasontedor/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "jasontedor", 
            "type": "User", 
            "id": 4744941, 
            "followers_url": "https://api.github.com/users/jasontedor/followers"
        }, 
        "event": "subscribed", 
        "id": 593265496
    }, 
    {
        "body": "and of course, @areek as well.. sorry for not adding you ^^", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/197975071", 
        "event": "commented", 
        "created_at": "2016-03-17T17:02:33Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-197975071", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "updated_at": "2016-03-17T17:02:33Z", 
        "user": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "id": 197975071, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593727032", 
        "created_at": "2016-03-17T17:02:33Z", 
        "actor": {
            "following_url": "https://api.github.com/users/areek/following{/other_user}", 
            "events_url": "https://api.github.com/users/areek/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/areek/orgs", 
            "url": "https://api.github.com/users/areek", 
            "gists_url": "https://api.github.com/users/areek/gists{/gist_id}", 
            "html_url": "https://github.com/areek", 
            "subscriptions_url": "https://api.github.com/users/areek/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/753679?v=3", 
            "repos_url": "https://api.github.com/users/areek/repos", 
            "received_events_url": "https://api.github.com/users/areek/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/areek/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "areek", 
            "type": "User", 
            "id": 753679, 
            "followers_url": "https://api.github.com/users/areek/followers"
        }, 
        "event": "mentioned", 
        "id": 593727032
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/593727033", 
        "created_at": "2016-03-17T17:02:33Z", 
        "actor": {
            "following_url": "https://api.github.com/users/areek/following{/other_user}", 
            "events_url": "https://api.github.com/users/areek/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/areek/orgs", 
            "url": "https://api.github.com/users/areek", 
            "gists_url": "https://api.github.com/users/areek/gists{/gist_id}", 
            "html_url": "https://github.com/areek", 
            "subscriptions_url": "https://api.github.com/users/areek/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/753679?v=3", 
            "repos_url": "https://api.github.com/users/areek/repos", 
            "received_events_url": "https://api.github.com/users/areek/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/areek/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "areek", 
            "type": "User", 
            "id": 753679, 
            "followers_url": "https://api.github.com/users/areek/followers"
        }, 
        "event": "subscribed", 
        "id": 593727033
    }, 
    {
        "body": "@ywelsch @jasontedor as request I rebased code and folded it into the \"standard\" TRA. I want to make another sweep myself with a fresh mind (it has been a while since I made this and it's still rough and has nocommits) but tests pass and I think you can start the initial review.", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/208899274", 
        "event": "commented", 
        "created_at": "2016-04-12T13:14:42Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-208899274", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "updated_at": "2016-04-12T13:14:42Z", 
        "user": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "id": 208899274, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/624111230", 
        "created_at": "2016-04-12T13:14:42Z", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "event": "mentioned", 
        "id": 624111230
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/624111231", 
        "created_at": "2016-04-12T13:14:42Z", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "event": "subscribed", 
        "id": 624111231
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/624111232", 
        "created_at": "2016-04-12T13:14:42Z", 
        "actor": {
            "following_url": "https://api.github.com/users/jasontedor/following{/other_user}", 
            "events_url": "https://api.github.com/users/jasontedor/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/jasontedor/orgs", 
            "url": "https://api.github.com/users/jasontedor", 
            "gists_url": "https://api.github.com/users/jasontedor/gists{/gist_id}", 
            "html_url": "https://github.com/jasontedor", 
            "subscriptions_url": "https://api.github.com/users/jasontedor/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/4744941?v=3", 
            "repos_url": "https://api.github.com/users/jasontedor/repos", 
            "received_events_url": "https://api.github.com/users/jasontedor/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/jasontedor/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "jasontedor", 
            "type": "User", 
            "id": 4744941, 
            "followers_url": "https://api.github.com/users/jasontedor/followers"
        }, 
        "event": "mentioned", 
        "id": 624111232
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/624111233", 
        "created_at": "2016-04-12T13:14:42Z", 
        "actor": {
            "following_url": "https://api.github.com/users/jasontedor/following{/other_user}", 
            "events_url": "https://api.github.com/users/jasontedor/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/jasontedor/orgs", 
            "url": "https://api.github.com/users/jasontedor", 
            "gists_url": "https://api.github.com/users/jasontedor/gists{/gist_id}", 
            "html_url": "https://github.com/jasontedor", 
            "subscriptions_url": "https://api.github.com/users/jasontedor/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/4744941?v=3", 
            "repos_url": "https://api.github.com/users/jasontedor/repos", 
            "received_events_url": "https://api.github.com/users/jasontedor/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/jasontedor/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "jasontedor", 
            "type": "User", 
            "id": 4744941, 
            "followers_url": "https://api.github.com/users/jasontedor/followers"
        }, 
        "event": "subscribed", 
        "id": 624111233
    }, 
    {
        "body": "Going through this PR, I have two main criticisms.\r\n\r\nMy first criticism is about the split of TRA and ReplicatedOperation. Although ReplicatedOperation looks simpler, the control flow is still complex between the two. Some logic is hiding in TRA and other in ReplicatedOperation. I'm not sure if the boundary of cutting up TransportReplicationAction and ReplicatedOperation is the right one is some cases (I wrote a comment to mark some of them). As is, TransportReplicationAction still contains lots of logic and retry code that is not directly related to transport. With this PR I want us to better understand the complex flow of failures and retry mechanisms, independent of the transport layer.\r\n\r\nMy second criticism is about naming. I find the method/interface names quite confusing and I think we need to come up with a clean vocabulary first. As an example for this let's look at the ReplicatedOperation class. The method performOnPrimary calls primary.performOperation and then also performOnReplica which is just the method that actually delegates to the action on the replica which then again has a similar name performOn (on the ReplicasProxy). Too many methods in ReplicatedOperation and TRA are called performXYZ but have vastly different semantics. Here are a few thoughts about naming:\r\n- performOnReplica could mean \"perform action on replica shard\". We know however that this can also be a primary shard. I would thus prefer to just have a method \"replicateRequest(ReplicationRequest, ShardRouting)\" which replicates a request to a shard (be it another primary or a replica shard). In our vocabulary we could use the words replication source and replication target.\r\n- I'm not sure whether we need the separation into Primary and ReplicasProxy interfaces. The methods failShard and performOn in ReplicasProxy don't share much commonality except that they both use transport. I think we could just fold Primary and ReplicasProxy into one interface (and call failShard from Primary failReplicationSourceShard and the other one failReplicationTargetShard).", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/209808686", 
        "event": "commented", 
        "created_at": "2016-04-14T07:40:10Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-209808686", 
        "actor": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "updated_at": "2016-04-14T07:40:10Z", 
        "user": {
            "following_url": "https://api.github.com/users/ywelsch/following{/other_user}", 
            "events_url": "https://api.github.com/users/ywelsch/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/ywelsch/orgs", 
            "url": "https://api.github.com/users/ywelsch", 
            "gists_url": "https://api.github.com/users/ywelsch/gists{/gist_id}", 
            "html_url": "https://github.com/ywelsch", 
            "subscriptions_url": "https://api.github.com/users/ywelsch/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/3718355?v=3", 
            "repos_url": "https://api.github.com/users/ywelsch/repos", 
            "received_events_url": "https://api.github.com/users/ywelsch/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/ywelsch/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "ywelsch", 
            "type": "User", 
            "id": 3718355, 
            "followers_url": "https://api.github.com/users/ywelsch/followers"
        }, 
        "id": 209808686, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "body": "> My first criticism is about the split of TRA and ReplicatedOperation. Although ReplicatedOperation looks simpler, the control flow is still complex between the two. Some logic is hiding in TRA and other in ReplicatedOperation. \r\n\r\nI think I failed to explain the purpose of this PR correctly (and it changed during the iteration here). The main goal of here is to create an as much as possible isolated class that takes a set of \"shards\" (one primary and the rest replicas) and performs and operation on them. I think of it as a replication black box - you give it a request and a set of \"shards\" (i'm quoting it as it can be anything as far as the class is concerned) and it will return the result of the operation on the primary and replicate it to all replicas. The reason for this is to allow to run integration tests on the \"shard level\" without the need for transport, masters and other node/cluster level services.\r\n\r\nRe the naming, how about the following (taking some of your suggestions):\r\n1) rename performOnPrimary to just run()\r\n2) rename ReplicasProxy to just Replicas (or ReplicasCollection)\r\n\r\n\r\n> I'm not sure whether we need the separation into Primary and ReplicasProxy interfaces. The methods failShard and performOn in ReplicasProxy don't share much commonality except that they both use transport. I think we could just fold Primary and ReplicasProxy into one interface (and call failShard from Primary failReplicationSourceShard and the other one failReplicationTargetShard).\r\n\r\nI'm not sure I follow you here. I think it's good to make a clear distinction between the primary and replicas as their role is very much different. Does calling the current ReplicasProxy as ReplicasCollection make methods like `performOn` and `failShard` (or just `fail` for consistency's sake) more intuitive for you?\r\n\r\n\r\n", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/comments/209868636", 
        "event": "commented", 
        "created_at": "2016-04-14T10:27:11Z", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16492#issuecomment-209868636", 
        "actor": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "updated_at": "2016-04-14T10:27:11Z", 
        "user": {
            "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
            "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/bleskes/orgs", 
            "url": "https://api.github.com/users/bleskes", 
            "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
            "html_url": "https://github.com/bleskes", 
            "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
            "repos_url": "https://api.github.com/users/bleskes/repos", 
            "received_events_url": "https://api.github.com/users/bleskes/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "bleskes", 
            "type": "User", 
            "id": 1006375, 
            "followers_url": "https://api.github.com/users/bleskes/followers"
        }, 
        "id": 209868636, 
        "issue_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16492"
    }, 
    {
        "commit_id": null, 
        "commit_url": null, 
        "url": "https://api.github.com/repos/elastic/elasticsearch/issues/events/627316141", 
        "created_at": "2016-04-14T13:07:02Z", 
        "actor": {
            "following_url": "https://api.github.com/users/override/following{/other_user}", 
            "events_url": "https://api.github.com/users/override/events{/privacy}", 
            "organizations_url": "https://api.github.com/users/override/orgs", 
            "url": "https://api.github.com/users/override", 
            "gists_url": "https://api.github.com/users/override/gists{/gist_id}", 
            "html_url": "https://github.com/override", 
            "subscriptions_url": "https://api.github.com/users/override/subscriptions", 
            "avatar_url": "https://avatars.githubusercontent.com/u/6036868?v=3", 
            "repos_url": "https://api.github.com/users/override/repos", 
            "received_events_url": "https://api.github.com/users/override/received_events", 
            "gravatar_id": "", 
            "starred_url": "https://api.github.com/users/override/starred{/owner}{/repo}", 
            "site_admin": false, 
            "login": "override", 
            "type": "User", 
            "id": 6036868, 
            "followers_url": "https://api.github.com/users/override/followers"
        }, 
        "event": "mentioned", 
        "id": 627316141
    }
]