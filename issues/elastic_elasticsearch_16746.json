{
    "assignee": null, 
    "assignees": [], 
    "body": "At the moment we open up the transport service before the local node has been fully initialized. This causes bug as some data structures are not fully initialized yet. See for example #16723. \n\nSadly,  we can't just start the TransportService last (as we do with the HTTP server) because the ClusterService needs to know the bound published network address for the local DiscoveryNode. This address can only be determined by actually binding (people may use, for example, port 0). Instead we start the TransportService as late as possible but block any incoming requests until the node has completed initialization. \n\nA couple of other cleanup during start time:\n1) The gateway service now starts before the initial cluster join so we can simplify the logic to recover state if the local node has become master.\n2) The discovery is started before the transport service accepts requests, but we only start the join process later using a dedicated method.\n\nCloses #16723\n", 
    "closed_at": "2016-02-24T02:07:36Z", 
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
        "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
        "followers_url": "https://api.github.com/users/bleskes/followers", 
        "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
        "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
        "gravatar_id": "", 
        "html_url": "https://github.com/bleskes", 
        "id": 1006375, 
        "login": "bleskes", 
        "organizations_url": "https://api.github.com/users/bleskes/orgs", 
        "received_events_url": "https://api.github.com/users/bleskes/received_events", 
        "repos_url": "https://api.github.com/users/bleskes/repos", 
        "site_admin": false, 
        "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
        "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
        "type": "User", 
        "url": "https://api.github.com/users/bleskes"
    }, 
    "comments": 4, 
    "comments_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16746/comments", 
    "created_at": "2016-02-21T15:54:06Z", 
    "events_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16746/events", 
    "html_url": "https://github.com/elastic/elasticsearch/pull/16746", 
    "id": 135221070, 
    "labels": [
        {
            "color": "009800", 
            "default": false, 
            "id": 146854632, 
            "name": ":Network", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/:Network"
        }, 
        {
            "color": "9e2c2c", 
            "default": true, 
            "id": 23173, 
            "name": "bug", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/bug"
        }, 
        {
            "color": "dddddd", 
            "default": false, 
            "id": 302749677, 
            "name": "v2.3.0", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/v2.3.0"
        }, 
        {
            "color": "dddddd", 
            "default": false, 
            "id": 246685314, 
            "name": "v5.0.0-alpha1", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/v5.0.0-alpha1"
        }
    ], 
    "labels_url": "https://api.github.com/repos/elastic/elasticsearch/issues/16746/labels{/name}", 
    "locked": false, 
    "milestone": null, 
    "number": 16746, 
    "pull_request": {
        "diff_url": "https://github.com/elastic/elasticsearch/pull/16746.diff", 
        "html_url": "https://github.com/elastic/elasticsearch/pull/16746", 
        "patch_url": "https://github.com/elastic/elasticsearch/pull/16746.patch", 
        "url": "https://api.github.com/repos/elastic/elasticsearch/pulls/16746"
    }, 
    "repository_url": "https://api.github.com/repos/elastic/elasticsearch", 
    "state": "closed", 
    "title": "Only accept transport requests after node is fully initialized", 
    "updated_at": "2016-02-24T02:10:07Z", 
    "url": "https://api.github.com/repos/elastic/elasticsearch/issues/16746", 
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1006375?v=3", 
        "events_url": "https://api.github.com/users/bleskes/events{/privacy}", 
        "followers_url": "https://api.github.com/users/bleskes/followers", 
        "following_url": "https://api.github.com/users/bleskes/following{/other_user}", 
        "gists_url": "https://api.github.com/users/bleskes/gists{/gist_id}", 
        "gravatar_id": "", 
        "html_url": "https://github.com/bleskes", 
        "id": 1006375, 
        "login": "bleskes", 
        "organizations_url": "https://api.github.com/users/bleskes/orgs", 
        "received_events_url": "https://api.github.com/users/bleskes/received_events", 
        "repos_url": "https://api.github.com/users/bleskes/repos", 
        "site_admin": false, 
        "starred_url": "https://api.github.com/users/bleskes/starred{/owner}{/repo}", 
        "subscriptions_url": "https://api.github.com/users/bleskes/subscriptions", 
        "type": "User", 
        "url": "https://api.github.com/users/bleskes"
    }
}