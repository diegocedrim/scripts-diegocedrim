{
    "assignee": null, 
    "assignees": [], 
    "body": "This script shows a regression between 0.17.8 and 0.18.5's query string searching:\n\n```\n#!/bin/sh\n\nset -e\n\nURL=\"http://localhost:9200\"\n\nfunction run() {\n   echo \"%\" \"$@\"\n   \"$@\"\n   echo\n   echo\n}\n\nrun curl -XDELETE \"$URL/test/\"\nrun curl -XDELETE \"$URL/_percolator\"\nrun curl -XPUT \"$URL/test/\" -d '\n{\n  \"index\": {},\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"dash_path\": { \"type\": \"custom\", \"tokenizer\": \"dash_path\" }\n      },\n      \"tokenizer\": {\n        \"dash_path\": { \"type\": \"path_hierarchy\", \"delimiter\": \"-\" }\n      }\n    }\n  },\n  \"mappings\": {\n    \"test\": {\n      \"properties\": {\n        \"location\": { \"type\":\"string\", \"analyzer\": \"dash_path\" }\n      }\n    }\n  }\n}'\nrun curl -XGET \"$URL/test/_mapping\"\nrun curl -XGET \"$URL/test/_analyze?field=test.location&pretty=true\" -d \"A-A-A\"\n\n\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"A-A-A\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"A-A-B\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"A-B-A\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"A-B-B\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"B-A-A\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"B-A-B\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"B-B-A\"}'\nrun curl -XPOST \"$URL/test/test/?refresh=true\" -d '{\"location\":\"B-B-B\"}'\nrun curl -XGET \"$URL/test/test/_search?pretty=true\" -d '\n{\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"location:A-B\",\n      \"analyzer\": \"keyword\"\n    }\n  }\n}'\n```\n\nIn 0.17.8, it returns the proper values:\n\n```\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 2,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"test\",\n      \"_id\" : \"Z2PnXuc9TbmPiLwdh9sOjA\",\n      \"_score\" : 1.0, \"_source\" : {\"location\":\"A-B-A\"}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"test\",\n      \"_id\" : \"RK20FlyfQBq29K503MiZSQ\",\n      \"_score\" : 1.0, \"_source\" : {\"location\":\"A-B-B\"}\n    } ]\n  }\n}\n```\n\nBut in 0.18.5, it returns this (It should only include things with the prefix `A-B`):\n\n```\n{\n  \"took\" : 1,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 4,\n    \"max_score\" : 1.4142135,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"test\",\n      \"_id\" : \"sHEIGa73QbmU3V6btCMmFg\",\n      \"_score\" : 1.4142135, \"_source\" : {\"location\":\"A-B-B\"}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"test\",\n      \"_id\" : \"dxSFQNu_RLCwNU4rQYnB4g\",\n      \"_score\" : 1.4142135, \"_source\" : {\"location\":\"A-B-A\"}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"test\",\n      \"_id\" : \"VyrcXa3AS3qoJ6ZueL1ufQ\",\n      \"_score\" : 0.5085423, \"_source\" : {\"location\":\"A-A-A\"}\n    }, {\n      \"_index\" : \"test\",\n      \"_type\" : \"test\",\n      \"_id\" : \"AYPtN0ppS7GNcBCKmLfIvw\",\n      \"_score\" : 0.5085423, \"_source\" : {\"location\":\"A-A-B\"}\n    } ]\n  }\n}\n```\n", 
    "closed_at": "2011-12-16T21:50:18Z", 
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/41300?v=3", 
        "events_url": "https://api.github.com/users/kimchy/events{/privacy}", 
        "followers_url": "https://api.github.com/users/kimchy/followers", 
        "following_url": "https://api.github.com/users/kimchy/following{/other_user}", 
        "gists_url": "https://api.github.com/users/kimchy/gists{/gist_id}", 
        "gravatar_id": "", 
        "html_url": "https://github.com/kimchy", 
        "id": 41300, 
        "login": "kimchy", 
        "organizations_url": "https://api.github.com/users/kimchy/orgs", 
        "received_events_url": "https://api.github.com/users/kimchy/received_events", 
        "repos_url": "https://api.github.com/users/kimchy/repos", 
        "site_admin": false, 
        "starred_url": "https://api.github.com/users/kimchy/starred{/owner}{/repo}", 
        "subscriptions_url": "https://api.github.com/users/kimchy/subscriptions", 
        "type": "User", 
        "url": "https://api.github.com/users/kimchy"
    }, 
    "comments": 0, 
    "comments_url": "https://api.github.com/repos/elastic/elasticsearch/issues/1547/comments", 
    "created_at": "2011-12-16T21:38:02Z", 
    "events_url": "https://api.github.com/repos/elastic/elasticsearch/issues/1547/events", 
    "html_url": "https://github.com/elastic/elasticsearch/issues/1547", 
    "id": 2584670, 
    "labels": [
        {
            "color": "9e2c2c", 
            "default": true, 
            "id": 23173, 
            "name": "bug", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/bug"
        }, 
        {
            "color": "DDDDDD", 
            "default": false, 
            "id": 192286, 
            "name": "v0.18.6", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/v0.18.6"
        }, 
        {
            "color": "DDDDDD", 
            "default": false, 
            "id": 174398, 
            "name": "v0.19.0.RC1", 
            "url": "https://api.github.com/repos/elastic/elasticsearch/labels/v0.19.0.RC1"
        }
    ], 
    "labels_url": "https://api.github.com/repos/elastic/elasticsearch/issues/1547/labels{/name}", 
    "locked": false, 
    "milestone": null, 
    "number": 1547, 
    "repository_url": "https://api.github.com/repos/elastic/elasticsearch", 
    "state": "closed", 
    "title": "0.18.5 ignores query string analyzer", 
    "updated_at": "2011-12-16T21:50:18Z", 
    "url": "https://api.github.com/repos/elastic/elasticsearch/issues/1547", 
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=3", 
        "events_url": "https://api.github.com/users/erickt/events{/privacy}", 
        "followers_url": "https://api.github.com/users/erickt/followers", 
        "following_url": "https://api.github.com/users/erickt/following{/other_user}", 
        "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", 
        "gravatar_id": "", 
        "html_url": "https://github.com/erickt", 
        "id": 84711, 
        "login": "erickt", 
        "organizations_url": "https://api.github.com/users/erickt/orgs", 
        "received_events_url": "https://api.github.com/users/erickt/received_events", 
        "repos_url": "https://api.github.com/users/erickt/repos", 
        "site_admin": false, 
        "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", 
        "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", 
        "type": "User", 
        "url": "https://api.github.com/users/erickt"
    }
}